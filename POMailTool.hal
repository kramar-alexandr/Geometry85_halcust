external inner updating procedure POCreateHtmlFile(record POVc,record MailVc);external inner procedure FindUserMailboxName(string,var string,var string);external inner procedure GetUserName(string, var string);// в этом файле только новые процедурыglobal // нова€ процедураupdating function Integer CreateAccMailFromPODClass(record POVc POr,var record MailVc Mailr,var string warning)BEGIN  Integer res;  row POVc POrw;  row MailVc MArw;  string 255 mailboxnr,tstr,user;  SetLangMode(LangUkrainian,"UKR",0);  res = 0;  user="HANSA";  FindUserMailboxName(user,mailboxnr,tstr);  if (blank(tstr)) then begin    res = 2289;    warning = CurrentUser;    goto LCreateMailFromPODAppr;  end;  MArw.RowTyp = 1;  MArw.AddrCode = tstr;  MatRowPut(Mailr,0,MArw);  Mailr.Header = "Запит на авторизацію замовлення ";  tstr="Прошу авторизувати замовлення постачальнику №" & POr.SerNr;  LineTextPut(Mailr,LineTextCnt(Mailr),tstr);  user=CurrentUser;  GetUserName(user,tstr);  tstr="/ " & tstr;  LineTextPut(Mailr,LineTextCnt(Mailr),tstr);  Mailr.TransDate = CurrentDate;  Mailr.SerNr = NextSerNr("MailVc",Mailr.TransDate,-1,false,"");  if (RecordStore(Mailr,false)) then begin end;    LCreateMailFromPODAppr:;  CreateAccMailFromPODClass = res;  RETURN;END;global // нова€ процедураupdating procedure AccMailPODsm()BEGIN  Integer wn,nwn;  record MailVc Mailr;  record POVc POr;  Integer err;  string 255 tstr;  Boolean testf;  wn = CurWindow;  if (WindowState(wn)==0) then begin  GetWindowRecord(wn,POr);  testf = true;    if (POr.OKFlag) then  begin testf=false;  end;    if (testf) then begin    err = CreateAccMailFromPODClass(POr,Mailr,tstr);      if (err!=0) then begin      MessageBox(err,": " & tstr);      end else begin        POCreateHtmlFile(POr,Mailr);        nwn = OpenWindow("MailDClass",1,0,"","",Mailr);        end;    end;  end;  RETURN;END;global // нова€ процедураupdating function Integer CreatePayMailFromPODClass(record POVc POr,var record MailVc Mailr,var string warning)BEGIN  Integer res;  row POVc POrw;  row MailVc MArw;  string 255 mailboxnr,tstr,user;  SetLangMode(LangUkrainian,"UKR",0);  res = 0;  user="HANSA";  FindUserMailboxName(user,mailboxnr,tstr);  if (blank(tstr)) then begin    res = 2289;    warning = CurrentUser;    goto LCreateMailFromPODAppr;  end;  MArw.RowTyp = 1;  MArw.AddrCode = tstr;  MatRowPut(Mailr,0,MArw);  Mailr.Header = "Запит на оплату ";  tstr="Прошу оплатити замовлення постачальнику №" & POr.SerNr;  LineTextPut(Mailr,LineTextCnt(Mailr),tstr);  user=CurrentUser;  GetUserName(user,tstr);  tstr="/ " & tstr;  LineTextPut(Mailr,LineTextCnt(Mailr),tstr);  Mailr.TransDate = CurrentDate;  Mailr.SerNr = NextSerNr("MailVc",Mailr.TransDate,-1,false,"");  if (RecordStore(Mailr,false)) then begin end;    LCreateMailFromPODAppr:;  CreatePayMailFromPODClass = res;  RETURN;END;global // нова€ процедураupdating procedure PayMailPODsm()BEGIN  Integer wn,nwn;  record MailVc Mailr;  record POVc POr;  Integer err;  string 255 tstr;  Boolean testf;  wn = CurWindow;  if (WindowState(wn)==0) then begin  GetWindowRecord(wn,POr);  testf = true;    if (POr.OKFlag)!=1 then  begin testf=false;  end;    if (testf) then begin    err = CreatePayMailFromPODClass(POr,Mailr,tstr);      if (err!=0) then begin      MessageBox(err,": " & tstr);      end else begin        POCreateHtmlFile(POr,Mailr);        nwn = OpenWindow("MailDClass",1,0,"","",Mailr);        end;    end;  end;  RETURN;END;global // нова€ процедураupdating function Integer CreateOKFlagMail(longint SerNr,var record MailVc Mailr,string type, string UsrCode)BEGIN  Integer res;  row MailVc MArw;  string 255 mailboxnr,tstr,user;  record UserVc USr;  SetLangMode(LangUkrainian,"UKR",0);  res = 0;  MArw.AddrCode = "hansa@g2.com";//SAV 6016  MArw.RowTyp = 1;  MatRowPut(Mailr,0,MArw);  USr.Code = UsrCode;  if (ReadFirstMain(USr,1,true)) then begin end;  tstr = USr.emailAddr;  MArw.RowTyp = 0;  MArw.AddrCode = tstr;  MatRowPut(Mailr,1,MArw);  if type=="POVc" then begin tstr = " Замовлення постачальнику № " & SerNr; end;  if type=="QTVc" then begin tstr = " Комерційна пропозиція № " & SerNr; end;  Mailr.Header = "Авторизована запис " & tstr;  Mailr.TransDate = CurrentDate;  Mailr.SerNr = NextSerNr("MailVc",Mailr.TransDate,-1,false,"");  if (RecordStore(Mailr,false)) then begin end;  CreateOKFlagMail = res;  RETURN;END;